{"version":3,"file":"index.umd.js","sources":["../src/modal.js","../src/progress.js","../src/inertia.js","../src/should-intercept.js"],"sourcesContent":["export default {\n  modal: null,\n  listener: null,\n\n  show(html) {\n    let page = document.createElement('html')\n    page.innerHTML = html\n    page.querySelectorAll('a').forEach(a => a.setAttribute('target', '_top'))\n\n    this.modal = document.createElement('div')\n    this.modal.style.position = 'fixed'\n    this.modal.style.width = '100vw'\n    this.modal.style.height = '100vh'\n    this.modal.style.padding = '50px'\n    this.modal.style.backgroundColor = 'rgba(0, 0, 0, .6)'\n    this.modal.style.zIndex = 200000\n    this.modal.addEventListener('click', () => this.hide())\n\n    let iframe = document.createElement('iframe')\n    iframe.style.backgroundColor = 'white'\n    iframe.style.borderRadius = '5px'\n    iframe.style.width = '100%'\n    iframe.style.height = '100%'\n    this.modal.appendChild(iframe)\n\n    document.body.prepend(this.modal)\n    document.body.style.overflow = 'hidden'\n    iframe.contentWindow.document.open()\n    iframe.contentWindow.document.write(page.outerHTML)\n    iframe.contentWindow.document.close()\n\n    this.listener = this.hideOnEscape.bind(this)\n    document.addEventListener('keydown', this.listener)\n  },\n\n  hide() {\n    this.modal.outerHTML = ''\n    this.modal = null\n    document.body.style.overflow = 'visible'\n    document.removeEventListener('keydown', this.listener)\n  },\n\n  hideOnEscape(event) {\n    if (event.keyCode === 27) {\n      this.hide()\n    }\n  },\n}\n","import Tinybar from 'tinybar'\n\nconst tinybar = new Tinybar()\n\nexport default {\n  delay: null,\n  loading: false,\n\n  start() {\n    clearTimeout(this.delay)\n\n    this.delay = setTimeout(() => {\n      this.loading = true\n      tinybar.go(10)\n    }, 250)\n  },\n\n  increment() {\n    if (this.loading) {\n      tinybar.go(50)\n    }\n  },\n\n  stop() {\n    clearTimeout(this.delay)\n\n    if (this.loading) {\n      tinybar.go(100)\n      this.loading = false\n    }\n  },\n}\n","import Modal from './modal'\nimport Progress from './progress'\n\nexport default {\n  resolveComponent: null,\n  updatePage: null,\n  version: null,\n  visitId: null,\n  abortController: null,\n\n  init({ initialPage, resolveComponent, updatePage }) {\n    this.resolveComponent = resolveComponent\n    this.updatePage = updatePage\n\n    if (window.history.state && this.navigationType() === 'back_forward') {\n      this.setPage(window.history.state)\n    } else if (window.sessionStorage.getItem('inertia.hardVisit')) {\n      window.sessionStorage.removeItem('inertia.hardVisit')\n      this.setPage(initialPage, { preserveState: true })\n    } else {\n      initialPage.url += window.location.hash\n      this.setPage(initialPage)\n    }\n\n    window.addEventListener('popstate', this.restoreState.bind(this))\n  },\n\n  navigationType() {\n    if (window.performance && window.performance.getEntriesByType('navigation').length) {\n      return window.performance.getEntriesByType('navigation')[0].type\n    }\n  },\n\n  isInertiaResponse(response) {\n    return response && response.headers.has('x-inertia')\n  },\n\n  hasBody(method) {\n    return ['GET', 'HEAD'].indexOf(method.toUpperCase()) === -1\n  },\n\n  getCookieValue(name) {\n    let match = document.cookie.match(new RegExp('(^|;\\\\s*)(' + name + ')=([^;]*)'))\n    return match ? decodeURIComponent(match[3]) : null\n  },\n\n  cancelActiveVisits() {\n    if (this.abortController) {\n      this.abortController.abort()\n    }\n\n    this.abortController = new AbortController()\n  },\n\n  createVisitId() {\n    this.visitId = {}\n    return this.visitId\n  },\n\n  visit(url, { method = 'get', data = {}, replace = false, preserveScroll = false, preserveState = false, only = [] } = {}) {\n    Progress.start()\n    this.cancelActiveVisits()\n    let visitId = this.createVisitId()\n\n    return window.fetch(url.toString(), {\n      method: method.toLowerCase(),\n      ...this.hasBody(method) ? { body: JSON.stringify(data) } : {},\n      signal: this.abortController.signal,\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json;charset=UTF-8',\n        Accept: 'text/html, application/xhtml+xml',\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-Xsrf-Token': this.getCookieValue('XSRF-TOKEN'),\n        'X-Inertia': true,\n        ...(only.length ? {\n          'X-Inertia-Partial-Component': this.page.component,\n          'X-Inertia-Partial-Data': only.join(','),\n        } : {}),\n        ...(this.version ? { 'X-Inertia-Version': this.version } : {}),\n      },\n    }).then(response => {\n      if (response.status === 409 && response.headers.has('x-inertia-location')) {\n        Progress.stop()\n        return this.hardVisit(true, response.headers.get('x-inertia-location'))\n      } else if (this.isInertiaResponse(response)) {\n        return response.json()\n      } else {\n        response.text().then(data => {\n          Progress.stop()\n          Modal.show(data)\n        })\n      }\n    }).catch(error => {\n      if (error.name === 'AbortError') {\n        return\n      } else {\n        return Promise.reject(error)\n      }\n    }).then(page => {\n      if (page) {\n        if (only.length) {\n          page.props = { ...this.page.props, ...page.props }\n        }\n\n        return this.setPage(page, { visitId, replace, preserveScroll, preserveState })\n      }\n    })\n  },\n\n  hardVisit(replace, url) {\n    window.sessionStorage.setItem('inertia.hardVisit', true)\n\n    if (replace) {\n      window.location.replace(url)\n    } else {\n      window.location.href = url\n    }\n  },\n\n  setPage(page, { visitId = this.createVisitId(), replace = false, preserveScroll = false, preserveState = false } = {}) {\n    this.page = page\n    Progress.increment()\n    return Promise.resolve(this.resolveComponent(page.component)).then(component => {\n      if (visitId === this.visitId) {\n        this.version = page.version\n        this.setState(page, replace, preserveState)\n        this.updatePage(component, page.props, { preserveState })\n        this.setScroll(preserveScroll)\n        Progress.stop()\n      }\n    })\n  },\n\n  setScroll(preserveScroll) {\n    if (!preserveScroll) {\n      window.scrollTo(0, 0)\n    }\n  },\n\n  setState(page, replace = false, preserveState = false) {\n    if (replace || page.url === `${window.location.pathname}${window.location.search}`) {\n      window.history.replaceState({\n        ...((preserveState && window.history.state) ? { cache: window.history.state.cache } : {}),\n        ...page,\n      }, '', page.url)\n    } else {\n      window.history.pushState(page, '', page.url)\n    }\n  },\n\n  restoreState(event) {\n    if (event.state) {\n      this.setPage(event.state)\n    }\n  },\n\n  replace(url, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, replace: true })\n  },\n\n  reload(options = {}) {\n    return this.replace(window.location.href, options)\n  },\n\n  post(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'post', data })\n  },\n\n  put(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'put', data })\n  },\n\n  patch(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'patch', data })\n  },\n\n  delete(url, options = {}) {\n    return this.visit(url, { ...options, method: 'delete' })\n  },\n\n  remember(data, key = 'default') {\n    let newState = { ...window.history.state }\n    newState.cache = newState.cache || {}\n    newState.cache[key] = data\n    this.setState(newState)\n  },\n\n  restore(key = 'default') {\n    if (window.history.state.cache && window.history.state.cache[key]) {\n      return window.history.state.cache[key]\n    }\n  },\n}\n","export default function shouldIntercept(event) {\n  return !(\n    (event.target && event.target.isContentEditable)\n    || event.defaultPrevented\n    || event.which > 1\n    || event.altKey\n    || event.ctrlKey\n    || event.metaKey\n    || event.shiftKey\n  )\n}\n"],"names":["modal","listener","show","html","page","document","createElement","innerHTML","querySelectorAll","forEach","a","setAttribute","style","position","width","height","padding","backgroundColor","zIndex","addEventListener","this","hide","iframe","borderRadius","appendChild","body","prepend","overflow","contentWindow","open","write","outerHTML","close","hideOnEscape","bind","removeEventListener","event","keyCode","tinybar","Tinybar","delay","loading","start","clearTimeout","setTimeout","go","increment","stop","resolveComponent","updatePage","version","visitId","abortController","init","ref","window","history","state","navigationType","setPage","sessionStorage","getItem","removeItem","initialPage","preserveState","url","location","hash","restoreState","performance","getEntriesByType","length","type","isInertiaResponse","response","headers","has","hasBody","method","indexOf","toUpperCase","getCookieValue","name","match","cookie","RegExp","decodeURIComponent","cancelActiveVisits","abort","AbortController","createVisitId","visit","Progress","fetch","toString","Object","toLowerCase","JSON","stringify","data","signal","credentials","Accept","only","component","join","then","status","hardVisit","get","json","text","Modal","catch","error","Promise","reject","props","replace","preserveScroll","setItem","href","resolve","setState","setScroll","scrollTo","replaceState","cache","pushState","options","reload","post","put","patch","delete","remember","key","newState","restore","target","isContentEditable","defaultPrevented","which","altKey","ctrlKey","metaKey","shiftKey"],"mappings":"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"}